<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Clogging the Toilet ‚Äî JS Edition</title>
<style>
  body { font-family: system-ui, sans-serif; display:flex; gap:20px; padding:20px; align-items:flex-start; }
  .panel { width:360px; border:2px solid #222; padding:12px; border-radius:8px; background:#f7f7f8; }
  .toilet { height:220px; width:140px; margin:10px auto; position:relative; border-radius:10px; background:#fff; box-shadow:0 6px 0 #ccc; }
  .water { position:absolute; left:8px; right:8px; bottom:8px; height:40px; background:#78c7ff; transition:height .4s linear; border-radius:6px; }
  .bowl { position:absolute; left:50%; transform:translateX(-50%); bottom:-32px; width:180px; height:80px; background:#fff; border-radius:0 0 90px 90px; box-shadow:0 6px 0 #ccc; }
  button { padding:10px 12px; margin:6px 4px; }
  .log { height:240px; overflow:auto; background:#111; color:#cfc; padding:8px; font-family:monospace; font-size:12px; border-radius:6px; }
  .big { font-size:20px; font-weight:700; }
</style>
</head>
<body>

<div class="panel">
  <div style="text-align:center;">
    <div class="big">üöΩ Clogging the Toilet ‚Äî JS Edition</div>
    <div style="color:#666">Simulate flushes, clogs, and heroic plunges</div>
  </div>

  <div class="toilet" id="toilet">
    <div class="water" id="water"></div>
    <div class="bowl"></div>
  </div>

  <div style="text-align:center">
    <button id="flushBtn">Flush üöΩ</button>
    <button id="plungeBtn">Plunge üßª</button>
    <button id="callPlumberBtn">Call Plumber (expensive)</button>
    <button id="resetBtn">Reset ‚ú®</button>
  </div>

  <div style="margin-top:10px; display:flex; gap:8px; justify-content:center">
    <label>Pipe Health
      <input id="health" type="range" min="0" max="100" value="75">
    </label>
    <label>Grease Factor
      <input id="grease" type="range" min="0" max="100" value="20">
    </label>
  </div>
</div>

<div class="panel" style="flex:1">
  <div style="display:flex; justify-content:space-between; align-items:center">
    <div class="big">Simulation Log</div>
    <div id="stats">Flushes: 0 | Clogs: 0 | Plunger uses: 0</div>
  </div>
  <div class="log" id="log"></div>
</div>

<script>
(() => {
  // state
  const water = document.getElementById('water');
  const logEl = document.getElementById('log');
  const statsEl = document.getElementById('stats');
  const flushBtn = document.getElementById('flushBtn');
  const plungeBtn = document.getElementById('plungeBtn');
  const callPlumberBtn = document.getElementById('callPlumberBtn');
  const resetBtn = document.getElementById('resetBtn');
  const healthRange = document.getElementById('health');
  const greaseRange = document.getElementById('grease');

  let flushCount = 0, clogCount = 0, plungeCount = 0;
  let waterLevel = 40; // px
  let clogged = false;
  let bgRandomness = 0; // for chaos egg

  function log(msg) {
    const time = new Date().toLocaleTimeString();
    logEl.innerHTML = `[${time}] ${msg}<br>` + logEl.innerHTML;
  }

  function updateStats() {
    statsEl.textContent = `Flushes: ${flushCount} | Clogs: ${clogCount} | Plunger uses: ${plungeCount}`;
  }

  function setWater(heightPx) {
    waterLevel = Math.max(4, Math.min(180, heightPx));
    water.style.height = waterLevel + 'px';
  }

  function chance(p) { return Math.random() < p; }

  function flush() {
    flushCount++;
    log(`You pressed Flush. Water whooshes... üåä`);
    // ideal flush behavior: lower water quickly then refill
    if (clogged) {
      log(`Too late ‚Äî it's clogged. Water rises dangerously... üí©`);
      setWater(waterLevel + 30);
      // chance of overflow depending on pipe health and grease factor
      const health = Number(healthRange.value)/100;
      const grease = Number(greaseRange.value)/100;
      if (chance((0.35 + grease) * (1 - health))) {
        log(`Oh no ‚Äî overflow! Towels, NOW. üö®`);
      }
      updateStats();
      return;
    }

    // compute clog probability: more grease and worse health increases risk
    const baseRisk = 0.03;
    const healthFactor = (100 - Number(healthRange.value)) / 120; // more when health low
    const greaseFactor = Number(greaseRange.value) / 70;
    const risk = baseRisk + healthFactor + greaseFactor;

    // flush animation: temporarily lower water
    setWater(10);
    setTimeout(() => {
      // refill
      setWater(40 + Math.floor(Math.random() * 20));
      // maybe create clog
      if (chance(risk)) {
        clogged = true; clogCount++;
        setWater(120);
        log(`It got clogged. Congratulations. üíÄ`);
        // JS chaos easter egg: random background math
        if (chance(0.08)) {
          bgRandomness = NaN; // intentionally silly
          log(`JS DOES A THING: background chaos -> NaN. (just a joke)`);
        }
      } else {
        log(`Flush successful. Clean as your dignity. ‚úÖ`);
      }
      updateStats();
    }, 700);

    updateStats();
  }

  function plunge() {
    plungeCount++;
    if (!clogged) {
      log(`You plunge heroically, but the toilet was fine. You look dramatic. ü¶∏‚Äç‚ôÇÔ∏è`);
      // slight chance you break a seal making health worse
      if (chance(0.06)) {
        const old = Number(healthRange.value);
        healthRange.value = Math.max(10, old - 20);
        log(`Plunge overforce damaged pipe health (oops).`);
      }
      updateStats();
      return;
    }

    log(`Plunging like an absolute unit... üßª`);
    // chance to fix depends on plunger count and health
    const health = Number(healthRange.value)/100;
    const successProb = 0.4 * health + 0.2; // 0.2..0.6 base
    if (chance(successProb)) {
      clogged = false;
      setWater(40);
      log(`Victory! The clog relents. You are a hero. üèÜ`);
    } else {
      setWater(Math.min(180, waterLevel + 20));
      log(`Nope. Still clogged. Keep plunging or call a pro.`);
    }
    updateStats();
  }

  function callPlumber() {
    log(`You called a plumber. They arrive in 30 minutes (metaphorically). Money: -$${Math.floor(80 + Math.random()*220)}`);
    clogged = false; setWater(40);
    // plumber fixes but reduces health slightly due to invasive work
    const old = Number(healthRange.value);
    healthRange.value = Math.max(40, old - 6);
    updateStats();
  }

  function resetSim() {
    flushCount = clogCount = plungeCount = 0;
    clogged = false; setWater(40);
    healthRange.value = 75;
    greaseRange.value = 20;
    logEl.innerHTML = "";
    updateStats();
    log('Simulation reset. Clean slate.');
  }

  // event hooks
  flushBtn.addEventListener('click', flush);
  plungeBtn.addEventListener('click', plunge);
  callPlumberBtn.addEventListener('click', callPlumber);
  resetBtn.addEventListener('click', resetSim);

  // little tutorial in the log at start
  log("Welcome to the toilet simulator. Try Flush, then Plunge. Adjust Pipe Health and Grease Factor. Don't blame me for your life choices.");
  updateStats();
})();
</script>